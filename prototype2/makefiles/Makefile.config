# Copyright (C) 2016 European Spallation Source
#

cxx=g++

include  = -I. -I..
warnings = -Werror -Wall -Wpedantic -Wextra -Wmissing-include-dirs
optflags = -O3
cxxflags = -std=c++11 $(optflags)  $(include) $(warnings)

ifdef NOKAFKA
kafkalibs=
else
kafkalibs= /usr/local/lib/librdkafka++.so /usr/local/lib/librdkafka.so
endif

ldflags = -L/usr/local/lib -lpthread -lrt -ldl
ldflags.so = -Wl,--whole-archive $(library) $(kafkalibs) \
-Wl,--no-whole-archive -fPIC -shared

ifdef PROF
cxxflags += -pg
ldflags += -pg
ldflags.so += -pg
endif

ifdef NOKAFKA
cxxflags +=-DNOKAFKA
endif

ifdef COV
cxxflags += -coverage
endif

Q=@
ifdef V
Q=
endif

ifndef GTEST
ldflags += -lgtest -pthread
cxxflags+= -I/usr/include
else
ldflags += $(GTEST)/lib/libgtest.a -pthread
cxxflags+= -I$(GTEST)/include -Wno-error=sign-compare
endif
